<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Shadow Console</title>
<link rel="stylesheet" href="style.css"/>
<script>
  if(!localStorage.getItem("uid") || !localStorage.getItem("exp")){
    location.href="login.html";
  }
</script>
</head>
<body>
<div class="panel">
  <h1>SHADOW â€¢ CONSOLE</h1>
  <p id="expiryInfo"></p>
  <p id="countdown"></p>
  <p id="clientLine"></p>
  <button id="logout">LOGOUT</button>
</div>

<script>
const uid = localStorage.getItem("uid");
const device = localStorage.getItem("deviceId");
const exp = new Date(localStorage.getItem("exp").replace(" ", "T"));
const cname = localStorage.getItem("clientName");

function updateCountdown(){
  const now = new Date();
  const diff = exp - now;
  if(diff <= 0){
    localStorage.clear();
    location.href="login.html";
    return;
  }
  const h = Math.floor(diff / 36e5);
  const m = Math.floor((diff % 36e5) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  expiryInfo.textContent = "Expiry: " + exp.toLocaleString();
  countdown.textContent = `Time left: ${h}h ${m}m ${s}s`;
  if(cname) clientLine.textContent = "Client: " + cname;
}

async function check(){
  const r = await fetch(`/api/check?id=${uid}&device=${device}`);
  const j = await r.json();
  if(!j.ok){
    localStorage.clear();
    location.href="login.html";
  }
}

setInterval(check, 30000);
setInterval(updateCountdown, 1000);
updateCountdown();

logout.onclick = ()=>{ localStorage.clear(); location.href="login.html"; };
</script>
</body>
</html>